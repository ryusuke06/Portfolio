<!--コメント欄-->
<div class="container" style="margin-top: 30px;">
  <%#= if assessment.present? %>
  <div class="row">
    <div class="col-xs-2"></div>
    <div class="col-xs-10">
      <table class="table">
        <tr class="active row">
          <th class="col-xs-2">
            名前
          </th>
          <th class="col-xs-2">
            評価
          </th>
          <th class="col-xs-1">
            タイトル
          </th>
          <th>
            口コミ
          </th>
          <td class="col-xs-1"></td>
        </tr>
        <% test.assessments.each do |assessment| %>
        <tr class="row">
          <td class="col-xs-2">
            <%= assessment.user.name %>
          </td>
          <td class="col-xs-2">
        <!--星評価-->
            <div id="star-rate-<%= assessment.id %>"></div>
            <script>
              $('#star-rate-<%= assessment.id %>').raty({
                size: 36,
                starOff:  '<%= asset_path('star-off.png') %>',
                starOn : '<%= asset_path('star-on.png') %>',
                starHalf: '<%= asset_path('star-half.png') %>',
                half: true,
                readOnly: true,
                score: <%= assessment.rate %>
              });
            </script>
          </td>
          <td class="col-xs-1">
            <%= assessment.title %>
          </td>
          <td>
            <%= assessment.review %>
          </td>
          <td class="col-xs-1">
            <% if user_signed_in? %>
              <% if assessment.user_id == current_user.id %>
                <%= link_to "削除", assessments_path(assessment.id), method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-sm btn-danger" %>
              <% end %>
            <% elsif admin_signed_in? %>
              <%= link_to "削除", assessments_path(assessment.id), method: :delete, data: {confirm: "本当に削除してもよろしいですか？"}, class: "btn-sm btn-danger" %>
            <% end %>
          </td>
        </tr>
        <% end %>
      </table>
    </div>
  </div>
  <%# end %>

  <% if user_signed_in? %>
    <div class="row" style="margin-top: 40px;">
      <div class="col-xs-2"></div>
      <div class="col-xs-10">
        <%= form_with url: assessments_path(test_id: test.id),model: [test, assessment],method: :post, local: true do |f| %>

          <!-- タイトル -->
          <div class="form-group row">
            <%= f.label :title, 'タイトル ', class:'col-md-3 col-form-label' %>
            <div class="col-md-9">
              <%= f.text_field :title, class: "form-control" %>
            </div>
          </div>

          <!-- 評価 -->
          <div class="form-group row" id="star">
            <%= f.label :rate,'評価 ', class:'col-md-3 col-form-label' %>
            <%= f.hidden_field :rate, id: :review_star %>
          </div>

          <!-- 口コミ -->
          <div class="form-group row">
            <%= f.label :review, '口コミ内容 ', class:'col-md-3 col-form-label' %>
            <div class="col-md-9">
              <%= f.text_area :review, class: "form-control", rows: "8",
                placeholder:'口コミ内容がなくても、タイトルと評価のみで投稿できます。
  再投稿すれば、前の投稿に上書きされますよ！' %>
            </div>
          </div>

          <!-- 確認ボタン -->
          <div class="form-group row justify-content-end">
            <div class="col-md-9">
              <% binding.pry %>
              <%= f.submit '投稿する', class:"btn btn-success" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<script>
//星評価
$('#star').raty({
  size     : 36,
  starOff:  '<%= asset_path('star-off.png') %>',
  starOn : '<%= asset_path('star-on.png') %>',
  starHalf: '<%= asset_path('star-half.png') %>',
  scoreName: 'assessment[rate]',
  half: true
  });
</script>